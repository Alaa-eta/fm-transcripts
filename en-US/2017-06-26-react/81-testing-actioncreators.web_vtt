WEBVTT

1
00:00:00.620 --> 00:00:03.910
&gt;&gt; Brian: Let's go ahead and
go create some test specs for

2
00:00:03.910 --> 00:00:06.166
action creators since those
are easy to test, as well.

3
00:00:06.166 --> 00:00:12.512
ActionCreators.spec.js, okay.

4
00:00:12.512 --> 00:00:15.650
The other thing is you
can go into reduce.spec.

5
00:00:15.650 --> 00:00:17.580
This should be a flow document as well.

6
00:00:19.770 --> 00:00:26.060
No reason that it can't be.
&gt;&gt; Brian: That shouldn't cause any errors,

7
00:00:26.060 --> 00:00:30.258
so good.
&gt;&gt; Brian: Let's go

8
00:00:30.258 --> 00:00:32.909
at flow into this document.

9
00:00:32.909 --> 00:00:36.157
This is the actionCreators.spec.js.

10
00:00:36.157 --> 00:00:40.336
Here we're going to import our two

11
00:00:40.336 --> 00:00:44.949
action creators, setSearchTern and

12
00:00:44.949 --> 00:00:50.149
addAPIData from ../actionCreators.

13
00:01:00.113 --> 00:01:00.888
&gt;&gt; Brian: So first one

14
00:01:00.888 --> 00:01:05.737
we're gonna test here is test,
&gt;&gt; Brian: Set search term,

15
00:01:08.189 --> 00:01:09.294
&gt;&gt; Brian: Which is gonna be a function.

16
00:01:13.327 --> 00:01:17.205
&gt;&gt; Brian: So we're going to expect if we

17
00:01:17.205 --> 00:01:26.198
pass it a setSearchTerm,
&gt;&gt; Brian: Okay,

18
00:01:26.198 --> 00:01:30.200
and let's say we pass it the search, we've
been using black this whole time, but

19
00:01:30.200 --> 00:01:33.467
here notes say I have New York,
so we'll just say that, New York.

20
00:01:33.467 --> 00:01:39.040
So let's go take a look at
the actionCreator itself.

21
00:01:40.130 --> 00:01:44.712
If we pass in New York here,
what do we expect to get back from it?

22
00:01:44.712 --> 00:01:50.056
We expect to get back a well formed
object of type, setSearchTerm,

23
00:01:50.056 --> 00:01:55.235
and payload of whatever that string
that we passed in is, right?

24
00:01:55.235 --> 00:02:02.640
Now remember that jest has that
ability to do snapshots, right?

25
00:02:02.640 --> 00:02:05.868
The only thing that a snapshot is,
is it is just a JSON structure, right?

26
00:02:05.868 --> 00:02:10.942
So our snapshots that we're generating for
React is just a JSON

27
00:02:10.942 --> 00:02:15.741
representation of what our
components look like, right?

28
00:02:15.741 --> 00:02:19.832
Well if we go in here
to our actionCreators,

29
00:02:19.832 --> 00:02:24.921
our actionCreators spec,
actionCreator spec.js,

30
00:02:24.921 --> 00:02:31.019
setSearchTerm is just going to
return a json structure, right?

31
00:02:31.019 --> 00:02:35.352
So we can actually just say
toMatchSnapshot here and

32
00:02:35.352 --> 00:02:37.820
leverage that same ability.

33
00:02:38.900 --> 00:02:43.950
So now, this JSON structure really
shouldn't change over time, right?

34
00:02:43.950 --> 00:02:47.230
And if it does change, we wanna be well
aware that that's what's happening.

35
00:02:49.020 --> 00:02:52.600
So to test actionCreators,
it's really just snapshots.

36
00:02:54.240 --> 00:02:57.130
I mean, I could come in here and
say, to equal,

37
00:03:01.193 --> 00:03:05.399
&gt;&gt; Brian: Type SET_SEARCH_TERM and

38
00:03:05.399 --> 00:03:11.420
then payload.
&gt;&gt; Brian: New York.

39
00:03:12.930 --> 00:03:17.070
I mean, that's fine too, but
why not leverage that snapshot ability?

40
00:03:17.070 --> 00:03:18.189
So that's what we're gonna do here.

41
00:03:21.970 --> 00:03:23.690
So again, we're gonna say yarn test.

42
00:03:26.170 --> 00:03:28.980
So the first time,
it's gonna create our snapshot.

43
00:03:28.980 --> 00:03:34.350
We can go in here and actually look at
our snapshot, actionCreators.spec.snap.

44
00:03:34.350 --> 00:03:38.380
And we expect the first one to equal
that particular object that we

45
00:03:38.380 --> 00:03:40.870
created with our actionCreator.

46
00:03:40.870 --> 00:03:44.640
What I like about this is say I decide
that later, I want a different test case,

47
00:03:44.640 --> 00:03:47.000
or maybe, no this is even better.

48
00:03:47.000 --> 00:03:51.750
Let's actually go into actionCreators, and
let's say we start using the error ability

49
00:03:51.750 --> 00:03:58.530
of these and I say error: null or
something like that.

50
00:03:58.530 --> 00:04:04.440
Now it's gonna fail, yarn test.

51
00:04:04.440 --> 00:04:09.530
This fails because here I started
adding this error ability, but

52
00:04:09.530 --> 00:04:10.730
now it's really easy to update it.

53
00:04:10.730 --> 00:04:14.627
That's what I anticipate, so
can just say yarn test:update, right?

54
00:04:14.627 --> 00:04:17.078
So that's why I like the snapshot tests,

55
00:04:17.078 --> 00:04:20.589
is that they're really easy to
update as your app evolves.

56
00:04:20.589 --> 00:04:21.933
Your tests evolve with you and

57
00:04:21.933 --> 00:04:24.845
you don't actually have to do a lot
of extra coding to get there.

58
00:04:26.475 --> 00:04:32.939
So coming back here and say yarn test.
&gt;&gt; Brian: And it passes.

59
00:04:34.180 --> 00:04:40.216
As you might imagine, going back to our
actionCreator spec, actionCreator spec.

60
00:04:40.216 --> 00:04:44.114
Testing addAPIData is
gonna be just as easy,

61
00:04:44.114 --> 00:04:49.362
addAPIData,
&gt;&gt; Brian: Here we're just going to say,

62
00:04:49.362 --> 00:04:55.556
expect,
&gt;&gt; Brian: Put this on multiple lines.

63
00:04:55.556 --> 00:05:00.725
AddAPIData, and we're just gonna give

64
00:05:00.725 --> 00:05:05.749
it some sort of API data of like 0.8.

65
00:05:05.749 --> 00:05:09.540
Title, in fact, we can just
really grab this from data.json.

66
00:05:09.540 --> 00:05:14.071
So we'll just grab Stranger Things here.
&gt;&gt; Brian: Go

67
00:05:14.071 --> 00:05:18.700
back to actionCreators.spec.

68
00:05:18.700 --> 00:05:22.360
Just going to paste that right there,
and we're gonna

69
00:05:22.360 --> 00:05:25.630
give it a rating because that's ultimately
what's coming back from the API.

70
00:05:25.630 --> 00:05:30.672
So rating: I don't know 8.6,
something like that.

71
00:05:33.660 --> 00:05:37.281
And then here we'll say,

72
00:05:37.281 --> 00:05:41.403
toMatchSnapShot and voila.

73
00:05:41.403 --> 00:05:47.407
And we're gonna say yarn test here.
&gt;&gt; Brian: And

74
00:05:47.407 --> 00:05:48.770
now we have an extra snapshot.

75
00:05:50.880 --> 00:05:54.340
So we can detect ever if
something happens with an API

76
00:05:54.340 --> 00:05:57.610
data that drifts in one direction or
the other.

77
00:05:57.610 --> 00:06:00.650
So if you look at the snap just to make
sure that everything looks like what

78
00:06:00.650 --> 00:06:03.150
you want it to, payload.

79
00:06:03.150 --> 00:06:07.060
It's gonna be this object here and
type is going to be ADD_API_DATA.

80
00:06:07.060 --> 00:06:08.680
That's exactly what we expect, so cool.

81
00:06:09.710 --> 00:06:15.660
Everything is good, it all works.
&gt;&gt; Brian: So

82
00:06:15.660 --> 00:06:19.280
testing actionCreators is really easy.

83
00:06:19.280 --> 00:06:21.460
It's a snap?

84
00:06:21.460 --> 00:06:30.470
No okay [LAUGH] That was horrible okay.

85
00:06:30.470 --> 00:06:31.629
Any questions about that?

86
00:06:34.110 --> 00:06:38.560
So this is why, again, one of the reasons
I really, really like redux is it makes

87
00:06:38.560 --> 00:06:44.930
testing these kind of micro pieces of
changing state pretty iron clad now.

88
00:06:44.930 --> 00:06:49.170
I'm guaranteed now that setSearchTerm
is going to create these

89
00:06:49.170 --> 00:06:52.280
objects the way I anticipated and
this is well tested and I trust it now.

