WEBVTT

1
00:00:00.400 --> 00:00:01.680
&gt;&gt; Brian: What I do wanna show you though.

2
00:00:01.680 --> 00:00:04.470
If you're interested in still
testing that user interaction.

3
00:00:04.470 --> 00:00:09.861
We don't really have a good way of
testing directly on that input anymore,

4
00:00:09.861 --> 00:00:14.055
because we don't have access
to header the way that we used

5
00:00:14.055 --> 00:00:18.838
to.
&gt;&gt; Brian: We could try and

6
00:00:18.838 --> 00:00:21.330
figure it out, but
that would be kinda tough.

7
00:00:21.330 --> 00:00:29.346
So let's try this instead.
&gt;&gt; Brian: So I'm gonna show you how,

8
00:00:29.346 --> 00:00:33.004
what we can do is we can actually
dispatch an action to Redux, and see,

9
00:00:33.004 --> 00:00:36.790
based on dispatching an action to Redux,
if we get the correct results.

10
00:00:36.790 --> 00:00:38.911
And let's go ahead and give that a shot.

11
00:00:38.911 --> 00:00:45.071
So unfortunately, we're gonna have to
kind of set up Redux here in the process.

12
00:00:45.071 --> 00:00:52.431
So we're gonna have to import, actually
this is gonna have to go above it, here.

13
00:00:52.431 --> 00:01:00.131
Import provider from react-redux.

14
00:01:00.131 --> 00:01:05.849
And we're also going to
have to import memory

15
00:01:05.849 --> 00:01:13.366
router from react-router-don.
&gt;&gt; Brian: So

16
00:01:13.366 --> 00:01:17.234
in order for our search components to not
just out now fail, we're gonna have to

17
00:01:17.234 --> 00:01:20.371
give it a router, because it has
a link component in the header.

18
00:01:20.371 --> 00:01:23.751
And we're going to have
to give it a provider.

19
00:01:23.751 --> 00:01:28.691
So that it can, we can provide the store
to it, and we're also going to have to

20
00:01:28.691 --> 00:01:36.845
import store from ./store.
&gt;&gt; Brian: Okay,

21
00:01:36.845 --> 00:01:40.572
we're gonna get rid of this.

22
00:01:40.572 --> 00:01:43.816
And what we're gonna do is
we're gonna do a shallow

23
00:01:43.816 --> 00:01:48.959
rendering.
&gt;&gt; Brian: With

24
00:01:48.959 --> 00:01:54.052
memory router on the outside,
no provider on the outside.

25
00:01:54.052 --> 00:01:58.572
Provider store equals store,

26
00:02:04.272 --> 00:02:07.452
&gt;&gt; Brian: And
then memory router inside of that.

27
00:02:17.606 --> 00:02:18.346
&gt;&gt; Brian: Okay?

28
00:02:26.146 --> 00:02:27.232
&gt;&gt; Brian: That's the other thing we need

29
00:02:27.232 --> 00:02:29.514
to do.
&gt;&gt; Brian: So

30
00:02:29.514 --> 00:02:31.890
we're gonna get rid of this
simulate change thing.

31
00:02:34.360 --> 00:02:37.160
I actually think we don't even need memory
router, now that I'm thinking about it.

32
00:02:37.160 --> 00:02:38.433
Let's keep going.

33
00:02:38.433 --> 00:02:43.893
We're gonna do store.dispatch up here.

34
00:02:43.893 --> 00:02:47.221
So we're actually going to dispatch
an action directly to the store.

35
00:02:47.221 --> 00:02:52.467
We're gonna send a set search term,
so we have to go import that as well,

36
00:02:52.467 --> 00:02:57.595
search word.
&gt;&gt; Brian: So

37
00:02:57.595 --> 00:03:00.202
let's go up to the top and
import that as well.

38
00:03:00.202 --> 00:03:07.242
So we're going to say import,
set search term from ./actionCreators.

39
00:03:16.581 --> 00:03:17.788
&gt;&gt; Brian: Okay, then we're gonna do

40
00:03:17.788 --> 00:03:21.050
the show countdown here and expect
it's gonna work exactly the same way.

41
00:03:22.840 --> 00:03:26.730
So now that I'm thinking, let's go
make sure this actually works first.

42
00:03:26.730 --> 00:03:33.647
So we're gonna say yarn test.
&gt;&gt; Brian: Could not find module store,

43
00:03:33.647 --> 00:03:34.574
that's right.

44
00:03:34.574 --> 00:03:37.850
Cuz we have to do dot dot,
and also dot dot there.

45
00:03:40.090 --> 00:03:42.751
Cuz we're inside the test directory,
so we have to go up one.

46
00:03:42.751 --> 00:03:45.431
Let's try that again, yarn test.

47
00:03:52.351 --> 00:03:54.731
&gt;&gt; Brian: And we got 0.

48
00:03:54.731 --> 00:04:03.053
All right, because,
&gt;&gt; Brian: Yup,

49
00:04:03.053 --> 00:04:05.109
we're gonna have to do render, right?

50
00:04:06.710 --> 00:04:07.890
Yup, okay.

51
00:04:07.890 --> 00:04:09.720
So this is why this is.

52
00:04:09.720 --> 00:04:14.720
So at this point, shallow is
actually not going to be enough for

53
00:04:14.720 --> 00:04:17.650
us to kind of get everything
that we need out of here.

54
00:04:17.650 --> 00:04:21.314
So we're gonna get rid of shallow, and
we're gonna keep shallow as well for

55
00:04:21.314 --> 00:04:24.589
the first two tests, but
we're gonna use render for the last test.

56
00:04:26.078 --> 00:04:28.651
Which is gonna be a deeper actually
render out all of the markup.

57
00:04:30.911 --> 00:04:32.771
&gt;&gt; Brian: Okay?

58
00:04:32.771 --> 00:04:35.818
Then down here,
we're gonna change shallow to

59
00:04:35.818 --> 00:04:40.374
render.
&gt;&gt; Brian: And now that

60
00:04:40.374 --> 00:04:45.225
we're actually gonna fully render out
everything, we actually can't do this kind

61
00:04:45.225 --> 00:04:50.163
of find anymore, cuz it's not gonna know
what's a React component and what's not.

62
00:04:50.163 --> 00:04:52.883
It's actually gonna render
out all to markup, so

63
00:04:52.883 --> 00:04:57.222
we're gonna have to give it a CSS
selector, and we're gonna do .show-card is

64
00:04:57.222 --> 00:05:01.861
what we called it.
&gt;&gt; Brian: And

65
00:05:01.861 --> 00:05:04.920
actually, we have to go add that as well,
so that we can hook into it.

66
00:05:04.920 --> 00:05:09.914
So open your show-card really quick.
&gt;&gt; Brian: And

67
00:05:09.914 --> 00:05:15.271
here where it says rapper 2,
we're just gonna say class equals show or

68
00:05:15.271 --> 00:05:18.233
class name rather, equals show-card

69
00:05:23.212 --> 00:05:25.292
&gt;&gt; Brian: So this is in show-card.

70
00:05:25.292 --> 00:05:30.303
Now if we go back to our
test search.spec.jsx,

71
00:05:30.303 --> 00:05:33.733
search.spec.jsx, this one.

72
00:05:33.733 --> 00:05:39.038
Now this should work, coming back to yarn

73
00:05:39.038 --> 00:05:45.850
test.
&gt;&gt; Brian: There we go, now it passes.

74
00:05:45.850 --> 00:05:49.320
Now I hope you're looking at this as like,
this is a lot of

75
00:05:49.320 --> 00:05:53.930
intimate knowledge to have about
this component to test it, it is.

76
00:05:53.930 --> 00:05:56.480
So I'm gonna go ahead and
assert while this is a valid test,

77
00:05:56.480 --> 00:05:58.380
it does test something.

78
00:05:58.380 --> 00:05:59.740
I'm not a huge fan of it.

79
00:05:59.740 --> 00:06:01.060
I actually liked what
we had better before,

80
00:06:01.060 --> 00:06:02.990
where we were just passing
in the search term and

81
00:06:02.990 --> 00:06:06.070
seeing that it worked given
that particular props.

82
00:06:06.070 --> 00:06:11.420
But if you wanna test integration there
between Redux and passing in the store,

83
00:06:11.420 --> 00:06:13.760
and passing in the action, and
then getting something out of it.

84
00:06:13.760 --> 00:06:19.050
In that particular sense,
this is how you're going to do that.

85
00:06:19.050 --> 00:06:22.630
But the sum of my entire story
here is once you introduce Redux,

86
00:06:22.630 --> 00:06:26.210
your react components become
a lot tougher to test.

87
00:06:26.210 --> 00:06:32.140
Significantly tougher to test, so
that's something to be aware of.

88
00:06:32.140 --> 00:06:35.110
The flip side of that which is
what I'm about to show after this,

89
00:06:35.110 --> 00:06:36.494
is that the Redux parts of it.

90
00:06:36.494 --> 00:06:40.381
So the actual state management part
becomes way easier to test, right, so

91
00:06:40.381 --> 00:06:42.614
you're kind of trading one for the other.

92
00:06:42.614 --> 00:06:45.910
And I'm gonna go ahead and assert that.

93
00:06:45.910 --> 00:06:49.430
The statement management part is
actually the important part to test.

94
00:06:49.430 --> 00:06:51.859
Again, we've been doing this for
three days and

95
00:06:51.859 --> 00:06:54.653
we've had to rewrite our
tests already twice, right?

96
00:06:54.653 --> 00:06:56.353
That kind of sucks, right?

97
00:06:56.353 --> 00:06:59.153
Rewriting tests is one of
my least favorite things to

98
00:06:59.153 --> 00:07:03.089
do.
&gt;&gt; Brian: Okay, so

99
00:07:03.089 --> 00:07:09.352
any questions about that?
&gt;&gt; Brian: It's

100
00:07:09.352 --> 00:07:12.643
up to you which one you prefer, which one
you actually are interested in testing.

101
00:07:12.643 --> 00:07:15.290
There's no reason that you
couldn't have both tests as well.

102
00:07:17.500 --> 00:07:22.285
So and what that would like is just, what
I can do here is I can just copy this.

103
00:07:22.285 --> 00:07:28.240
And let's go back to where it was before,
back when

104
00:07:28.240 --> 00:07:33.098
we were doing shallow without provider.

105
00:07:54.050 --> 00:07:56.690
&gt;&gt; Brian: So
I think this is fine right there.

106
00:07:56.690 --> 00:07:59.970
So let's copy this test case.

107
00:07:59.970 --> 00:08:04.011
And after this, I'll push a branch so
you can have both of them as well.

108
00:08:04.011 --> 00:08:10.349
And you can kind of compare them.
&gt;&gt; Brian: So

109
00:08:10.349 --> 00:08:15.461
this is gonna be without Redux.

110
00:08:15.461 --> 00:08:20.536
And this one is going to be with

111
00:08:20.536 --> 00:08:27.490
Redux,
&gt;&gt; Brian: And now we say yarn test.

112
00:08:27.490 --> 00:08:30.390
Make sure both of those pass
the way we expect them to, and

113
00:08:30.390 --> 00:08:33.050
now we have an extra test,
one we test with Redux and one without.

114
00:08:33.050 --> 00:08:36.880
So you're welcome to make it, I probably
would not write both of these tests,

115
00:08:36.880 --> 00:08:40.120
but it's good to demonstrate
to what's going on.

116
00:08:40.120 --> 00:08:41.969
Various strategies of
testing these components.

117
00:08:45.260 --> 00:08:46.560
Something worth noting.

118
00:08:48.610 --> 00:08:52.460
Search should render based on
without Redux takes one millisecond,

119
00:08:53.840 --> 00:08:56.780
with Redux it's gonna
take 35 milliseconds.

120
00:08:56.780 --> 00:08:57.830
Why is that?

121
00:08:57.830 --> 00:09:00.020
It's not Redux, Redux is plenty fast.

122
00:09:00.020 --> 00:09:01.700
It's the render, right?

123
00:09:01.700 --> 00:09:07.920
This color right here,
render wherever it is, this is expensive.

124
00:09:07.920 --> 00:09:10.200
Cuz this is actually going to
render everything out to a string.

125
00:09:10.200 --> 00:09:13.520
It has jsdom built in and
it does all sorts of this stuff for you.

126
00:09:13.520 --> 00:09:16.180
So that's something to keep in mind.

127
00:09:16.180 --> 00:09:19.160
The more you use render
the slower it's gonna be.

128
00:09:19.160 --> 00:09:21.740
Render is still pretty fast, but
as soon as it's started again to static

129
00:09:21.740 --> 00:09:24.940
rendering it gets really slow,
really fast, so.

