WEBVTT

1
00:00:00.150 --> 00:00:04.790
&gt;&gt; Brian: We're going to fix our
tests cuz we broke them yet again.

2
00:00:04.790 --> 00:00:07.653
So I want you to go ahead and
open search.jsx.

3
00:00:10.075 --> 00:00:13.421
&gt;&gt; Brian: We have a big problem here,
in fact, I'm gonna show you just to prove

4
00:00:13.421 --> 00:00:18.041
that if I run yarn test here,
&gt;&gt; Brian: It's gonna,

5
00:00:18.041 --> 00:00:19.493
I think all of them fail.

6
00:00:19.493 --> 00:00:21.013
Yep, total failure.

7
00:00:24.034 --> 00:00:25.479
&gt;&gt; Brian: For
various reasons you can see all,

8
00:00:25.479 --> 00:00:28.470
it's gonna give you the stack trace up
there, but I'll explain to you why.

9
00:00:29.760 --> 00:00:34.460
The first thing that kind of sucks with
Redux and integrating with Connect,

10
00:00:34.460 --> 00:00:37.960
is what are we actually exporting here?

11
00:00:37.960 --> 00:00:41.470
We're not actually exporting search,
right?

12
00:00:41.470 --> 00:00:42.210
Down here at the bottom.

13
00:00:42.210 --> 00:00:44.530
We're exporting a connected search.

14
00:00:46.780 --> 00:00:50.200
So let me demonstrate to you what I'm
talking about using the DevTools.

15
00:00:50.200 --> 00:00:54.270
If I inspect here, I go into React.

16
00:00:56.310 --> 00:01:03.840
Notice, let's see,
here I have search, right?

17
00:01:03.840 --> 00:01:05.330
But what's the component above it?

18
00:01:06.760 --> 00:01:08.910
It's a connected search, right?

19
00:01:08.910 --> 00:01:11.382
It's a component that wraps search.

20
00:01:11.382 --> 00:01:13.483
And that's what connect returns.

21
00:01:13.483 --> 00:01:16.320
It returns a connected search, right?

22
00:01:16.320 --> 00:01:20.994
So we're not at,
this component inside of search.spec.jsx

23
00:01:20.994 --> 00:01:25.153
that we're importing right
here is connected search.

24
00:01:25.153 --> 00:01:31.450
Which means this search depends on Redux,
which is kind of a problem for us to test.

25
00:01:31.450 --> 00:01:34.083
Because I don't wanna bring in Redux
every time I wanna test this component.

26
00:01:34.083 --> 00:01:37.010
I wanna test search,
I don't wanna test Redux.

27
00:01:38.210 --> 00:01:42.170
So there's a couple ways
of mitigating this.

28
00:01:42.170 --> 00:01:45.070
I'm gonna show you kind of
one of the easier ways.

29
00:01:45.070 --> 00:01:49.183
So come back to search.jsx, really quick.

30
00:01:49.183 --> 00:01:54.630
Down here we're gonna have export
default connect and that's totally fine.

31
00:01:54.630 --> 00:02:02.028
But what we're gonna do
here is we're going to say,

32
00:02:02.028 --> 00:02:07.083
export const Unwrapped = Search.

33
00:02:07.083 --> 00:02:11.780
The only place that we're ever going
to use this is for testing purposes.

34
00:02:11.780 --> 00:02:15.185
But we're just going to export
an unwrapped version of it and

35
00:02:15.185 --> 00:02:17.203
that's going to be called search.

36
00:02:17.203 --> 00:02:22.603
So now if we go back to search.spec.jsx,

37
00:02:22.603 --> 00:02:28.303
we can come in here and
say import Unwrapped.

38
00:02:30.903 --> 00:02:35.356
&gt;&gt; Brian: And if you wanna make it
a little bit more succinct in the name

39
00:02:35.356 --> 00:02:37.863
you can say as UnwrappedSearch.

40
00:02:42.443 --> 00:02:43.462
&gt;&gt; Brian: That's how you do it,

41
00:02:43.462 --> 00:02:46.583
like if I just say unwrapped right
here it would be called unwrapped.

42
00:02:46.583 --> 00:02:48.288
But I wanna make it a little
bit more accurate so

43
00:02:48.288 --> 00:02:49.703
I'm gonna call as UnwrappedSearch.

44
00:02:49.703 --> 00:02:50.663
That's how you do that.

45
00:02:53.444 --> 00:02:54.064
&gt;&gt; Brian: Okay.

46
00:02:57.864 --> 00:03:03.764
&gt;&gt; Brian: Now with unwrapped search,
I can just call this unwrapped search.

47
00:03:03.764 --> 00:03:08.481
And we're also are going to have
to give it a search term because

48
00:03:08.481 --> 00:03:10.264
it depends on that now.

49
00:03:15.104 --> 00:03:19.420
&gt;&gt; Brian: So
let's comment these tests out first.

50
00:03:19.420 --> 00:03:25.874
So I'm gonna say xtest here, not comment
them out but, stop running them.

51
00:03:25.874 --> 00:03:30.840
And I think,
&gt;&gt; Brian: This should work now,

52
00:03:30.840 --> 00:03:32.274
if you say yarn test.

53
00:03:32.274 --> 00:03:35.050
I'm gonna stop my API server and close it.

54
00:03:42.304 --> 00:03:45.900
&gt;&gt; Brian: So our snapshot
kinda got updated here, right?

55
00:03:45.900 --> 00:03:50.440
Before we used to have header actually
embedded into search, we changed that, so

56
00:03:50.440 --> 00:03:54.280
now it's a different component
that's a connect header, right?

57
00:03:54.280 --> 00:03:56.060
That's fine, that's what we expect.

58
00:03:56.060 --> 00:03:59.020
So we're gonna run this
again as yarn test:update.

59
00:04:02.421 --> 00:04:04.900
&gt;&gt; Brian: And now,
we have a passing test, right?

60
00:04:04.900 --> 00:04:05.680
We fixed one of them.

61
00:04:07.270 --> 00:04:09.440
So, let's go fix another one.

62
00:04:11.720 --> 00:04:13.840
Same kind of story here,
we're gonna say UnwrappedSearch.

63
00:04:18.831 --> 00:04:25.881
&gt;&gt; Brian: And this is going to be,
&gt;&gt; Brian: Search term equals blank.

64
00:04:39.101 --> 00:04:40.381
&gt;&gt; Brian: Our searchTerm rather.

65
00:04:44.301 --> 00:04:47.625
&gt;&gt; Brian: And
make that test again so it will run.

66
00:04:47.625 --> 00:04:49.593
Let's go make sure that that one works.

67
00:04:49.593 --> 00:04:51.181
So we're gonna say yarn test again.

68
00:04:55.161 --> 00:04:56.901
&gt;&gt; Brian: Two passed, halfway there.

69
00:05:01.062 --> 00:05:04.058
&gt;&gt; Brian: So
now we wanna test this one, and

70
00:05:04.058 --> 00:05:07.810
this one's a little bit tougher to test.

71
00:05:07.810 --> 00:05:09.576
There's a couple things
that we could do here.

72
00:05:09.576 --> 00:05:16.870
We could test this.

73
00:05:16.870 --> 00:05:22.578
And rather than doing,
kind of going through the process and

74
00:05:22.578 --> 00:05:24.890
simulating the event and
all that kind of stuff.

75
00:05:24.890 --> 00:05:26.660
We could try that.

76
00:05:26.660 --> 00:05:31.915
You could totally just do
UnwrappedSearch here and

77
00:05:31.915 --> 00:05:35.459
say searchTerm{searchWord},

78
00:05:35.459 --> 00:05:40.968
then we wouldn't have to
do this simulate business.

79
00:05:46.168 --> 00:05:48.528
&gt;&gt; Brian: I think that should for
the most part work.

80
00:05:55.648 --> 00:05:58.068
&gt;&gt; Brian: So let's see if that works.

81
00:05:58.068 --> 00:06:00.882
I did not, I did, okay?

82
00:06:00.882 --> 00:06:02.830
And so this works, right?

83
00:06:02.830 --> 00:06:05.874
If you're happy with that test, and
you don't actually wanna test these

84
00:06:05.874 --> 00:06:08.376
interactions, you just want to
test if you give it a search,

85
00:06:08.376 --> 00:06:10.312
whether it renders
the right amount of cards.

86
00:06:10.312 --> 00:06:12.470
Cool, this totally works.

